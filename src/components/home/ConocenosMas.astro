---
import { fetchDestacadas, getYouTubeThumbnail } from "@/utils/fetchDestacadas";
import Title from "../Title.astro";
import Container from "../containers/Container.astro";

const destacadas = await fetchDestacadas();
if (!destacadas || destacadas.length === 0) {
  return;
}
---

<Container class="w-full mt-26 sm:mt-16">
  <Title
    title="Conocé más"
    subtitle="Te invitamos a conocer más sobre nosotros, nuestros programas y todo lo que hacemos."
    imageUrl="/sections-icons/destacadas-icon.webp"
    className="mt-10"
    link="/conocenos"
    verTodasTexto="todas"
  />

  <section class="grid grid-cols-2 lg:grid-cols-4 gap-6 my-10 min-h-[200px]">
    {
      destacadas.slice(0, 8).map((d) => {
        let thumbnail = "";
        let altText = "";
        let href: string | undefined = undefined;

        if (d.type === "video") {
          thumbnail = getYouTubeThumbnail(d.youtubeUrl);
          altText = `Ver video: ${d.title}`;
          href = d.youtubeUrl;
        } else {
          thumbnail = d.image.url;
          altText = d.image.alt;
          href = d.link;
        }

        return href ? (
          <a
            href={href}
            target="_blank"
            rel="noopener noreferrer"
            class="flex flex-col group transition-transform duration-150"
          >
            <div class="w-full aspect-square overflow-hidden rounded-lg relative">
              <img
                src={thumbnail}
                alt={altText}
                class="w-full h-full object-cover rounded-sm group-hover:scale-101 transition-transform duration-300"
              />

              {d.type === "video" && (
                <div class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/10 transition-colors">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="w-12 h-12 text-white drop-shadow-lg opacity-90"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
              )}
            </div>
            <span class="font-ibm text-white font-medium uppercase mt-2 group-hover:font-semibold transitions-all duration-300">
              {d.title}
            </span>
          </a>
        ) : (
          <div class="flex flex-col group transition-transform duration-150">
            <div class="w-full aspect-square overflow-hidden rounded-lg">
              <img
                src={thumbnail}
                alt={altText}
                class="w-full h-full object-cover rounded-sm group-hover:scale-101 transition-transform duration-300"
              />
            </div>
            <p class="font-ibm text-white font-medium uppercase mt-2 group-hover:font-semibold transitions-all duration-300">
              {d.title}
            </p>
          </div>
        );
      })
    }
  </section>
</Container>
